$(window).load(function(){$("#timespan").keyup(function(){var e=2;var t=3;var n=4;var r=5;var i=0;var s=1;var o=2;var u=$(this).val();var a="{Dow} {Mon} {dd} {year} {h}:{mm} {tt}";var f=/(\d{1,2}(:\d{2})?)\s*([AaPp]\.?[Mm]?\.?)?/;var l=/(([^:-]*?)\s+)?/;var c=new RegExp("^"+l.source+f.source+"$");var h=/^\s*([^-]+?)\s*(-|$)/;var p=/-\s*([^-]+?)\s*$/;var d=h.test(u)?h.exec(u)[1]:"";var v=p.test(u)?p.exec(u)[1]:"";var m=Date.create(d);var g=Date.create(v);var y=c.test(d);var b=c.test(v);if(y){var w=c.exec(d);var E=[w[e],w[t],w[r]];if(!E[i])E[i]="today";if(!w[n])E[s]+=":00";if(E[o])E[o]=/^[Pp]/.test(E[o])?"pm":"am";m=Date.create(E.join(" "))}if(b){var S=c.exec(v);var x=[S[e],S[t],S[r]];if(!x[i]){if(y)x[i]=E[i];else x[i]="today"}if(!S[n])x[s]+=":00";if(x[o])x[o]=/^[Pp]/.test(x[o])?"pm":"am";g=Date.create(x.join(" "))}if(y&&b){if(x[o]&&!E[o])E[o]=x[o];else if(E[o]&&!x[o])x[o]=E[o];E[o]=/^[Pp]/.test(E[o])?"pm":"am";x[o]=/^[Pp]/.test(x[o])?"pm":"am";m=Date.create(E.join(" "));g=Date.create(x.join(" "));while(g.minutesSince(m)<=0){if(!S[r])g.addHours(12);else if(!w[r])m.addHours(-12);else g.addHours(24)}}else{while(g.minutesSince(m)<=0){if(b){if(S[r])g.addHours(24);else g.addHours(12)}else if(y){if(w[r])m.addHours(-24);else m.addHours(-12)}else g.addHours(24)}if(g.hoursSince(m)>=12&&g.hoursSince(m)<24){if(b&&!S[r])g.addHours(-12);else if(y&&!w[r])m.addHours(12)}}if(m.isValid()&&g.isValid()){while(m.getMinutes()%5!=0)m.addMinutes(-1);while(g.getMinutes()%5!=0)g.addMinutes(1);m.reset("seconds");g.reset("seconds")}var T=(g.minutesSince(m)/60).toFixed(2);if(T=="NaN")T="0";$("#entry_begin_time").val(m.isValid()?m.format(a):"Waiting...");$("#entry_end_time").val(g.isValid()?g.format(a):"Waiting...");$("#total_hours").val(T)})})