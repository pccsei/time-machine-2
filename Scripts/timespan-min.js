function populate_edit_fields() { var e = Date.create($("#entry_begin_time").val()); var t = Date.create($("#entry_end_time").val()); var n = (t.minutesSince(e) / 60).toFixed(2); var r = e.format(date_format); var i = t.format(date_format); $(".begin_time").val(e.format(date_format)); $(".end_time").val(t.format(date_format)); $("#timespan").val(e.format("{M}/{dd}/{yy} {h}:{mm} {tt}") + " - " + t.format("{M}/{dd}/{yy} {h}:{mm} {tt}")); $("#total_hours").val(n) } function interpret_timespan(e) { var t = 2; var n = 3; var r = 4; var i = 5; var s = 0; var o = 1; var u = 2; var a = /(\d{1,2}(:\d{2})?)\s*([AaPp]\.?[Mm]?\.?)?/; var f = /(([^:-]*?)\s+)?/; var l = new RegExp("^" + f.source + a.source + "$"); var c = /^\s*([^-]+?)\s*(-|$)/; var h = /-\s*([^-]+?)\s*$/; var p = c.test(e) ? c.exec(e)[1] : ""; var d = h.test(e) ? h.exec(e)[1] : ""; var v = Date.create(p); var m = Date.create(d); var g = l.test(p); var y = l.test(d); if (g) { var b = l.exec(p); var w = [b[t], b[n], b[i]]; if (!w[s]) w[s] = "today"; if (!b[r]) w[o] += ":00"; if (w[u]) w[u] = /^[Pp]/.test(w[u]) ? "pm" : "am"; v = Date.create(w.join(" ")) } if (y) { var E = l.exec(d); var S = [E[t], E[n], E[i]]; if (!S[s]) { if (g) S[s] = w[s]; else S[s] = "today" } if (!E[r]) S[o] += ":00"; if (S[u]) S[u] = /^[Pp]/.test(S[u]) ? "pm" : "am"; m = Date.create(S.join(" ")) } if (g && y) { if (S[u] && !w[u]) w[u] = S[u]; else if (w[u] && !S[u]) S[u] = w[u]; w[u] = /^[Pp]/.test(w[u]) ? "pm" : "am"; S[u] = /^[Pp]/.test(S[u]) ? "pm" : "am"; v = Date.create(w.join(" ")); m = Date.create(S.join(" ")); while (m.minutesSince(v) <= 0) { if (!E[i]) m.addHours(12); else if (!b[i]) v.addHours(-12); else m.addHours(24) } } else { while (m.minutesSince(v) <= 0) { if (y) { if (E[i]) m.addHours(24); else m.addHours(12) } else if (g) { if (b[i]) v.addHours(-24); else v.addHours(-12) } else m.addHours(24) } if (m.hoursSince(v) >= 12 && m.hoursSince(v) < 24) { if (y && !E[i]) m.addHours(-12); else if (g && !b[i]) v.addHours(12) } } if (v.isValid() && m.isValid()) { while (v.getMinutes() % 5 != 0) { v.addMinutes(-1); m.addMinutes(-1) } while (m.getMinutes() % 5 != 0) m.addMinutes(1); v.reset("seconds"); m.reset("seconds") } var x = (m.minutesSince(v) / 60).toFixed(2); if (x == "NaN") x = "Waiting..."; $(".begin_time").val(v.isValid() ? v.format(date_format) : "Waiting..."); $(".end_time").val(m.isValid() ? m.format(date_format) : "Waiting..."); $("#total_hours").val(x) } var date_format = "{Dow} {Mon} {dd} {year} {h}:{mm} {tt}"; $(window).load(function () { $("#time_suggestions li a").click(function () { $("#timespan").val($(this).text()); interpret_timespan($("#timespan").val()) }); $("#timespan").keyup(interpret_timespan($(this).val())) })